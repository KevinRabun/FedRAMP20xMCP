# RSC (Resource) Patterns for FedRAMP 20x Compliance
# Family: RSC - Resource Management Requirements
# These patterns detect compliance with FRR-RSC requirements for resource allocation and management

---
pattern_id: rsc.allocation.resource_limits
name: Resource Limits Configuration
family: RSC
severity: high
description: |
  Detects resource limit configuration (CPU, memory) for workloads.
  FRR-RSC requires proper resource allocation and limits.
pattern_type: configuration
languages:
  - yaml
  - python
  - csharp
  - java
regex_patterns:
  - pattern: 'resources:.*limits:|resources:.*requests:'
    flags: IGNORECASE | DOTALL
  - pattern: 'cpu:.*memory:|limits.*cpu|limits.*memory'
    flags: IGNORECASE
  - pattern: 'MAX_MEMORY|MAX_CPU|RESOURCE_LIMIT'
    flags: IGNORECASE
finding_template:
  title: Resource limits configured
  description: Configuration specifies resource limits for workloads
  recommendation: Ensure limits prevent resource exhaustion per FRR-RSC-01
  references:
    - FRR-RSC-01

---
pattern_id: rsc.monitoring.resource_metrics
name: Resource Metrics Monitoring
family: RSC
severity: high
description: Detects resource metrics collection and monitoring
pattern_type: function_call
languages:
  - python
  - csharp
  - java
  - typescript
regex_patterns:
  - pattern: 'cpu.*usage|memory.*usage|disk.*usage'
    flags: IGNORECASE
  - pattern: 'metrics.*cpu|metrics.*memory|resource.*monitor'
    flags: IGNORECASE
  - pattern: 'psutil|performance.*counter'
    flags: IGNORECASE
finding_template:
  title: Resource metrics monitoring detected
  description: Code monitors CPU, memory, or disk usage
  recommendation: Export metrics to centralized monitoring per KSI-MLA-01
  references:
    - FRR-RSC-02
    - KSI-MLA-01

---
pattern_id: rsc.scaling.autoscaling
name: Autoscaling Configuration
family: RSC
severity: medium
description: Detects autoscaling configuration for dynamic resource allocation
pattern_type: configuration
languages:
  - yaml
regex_patterns:
  - pattern: 'kind:.*HorizontalPodAutoscaler|apiVersion:.*autoscaling'
    flags: IGNORECASE
  - pattern: 'minReplicas|maxReplicas|targetCPUUtilizationPercentage'
    flags: IGNORECASE
  - pattern: 'autoscale|auto_scale|autoScaling'
    flags: IGNORECASE
finding_template:
  title: Autoscaling configured
  description: Configuration includes autoscaling for dynamic resource allocation
  recommendation: Set appropriate min/max replicas and thresholds per FRR-RSC-03
  references:
    - FRR-RSC-03

---
pattern_id: rsc.quota.namespace_quota
name: Namespace Resource Quota
family: RSC
severity: high
description: Detects resource quota configuration at namespace level
pattern_type: configuration
languages:
  - yaml
regex_patterns:
  - pattern: 'kind:.*ResourceQuota'
    flags: IGNORECASE
  - pattern: 'hard:.*requests\.cpu|hard:.*limits\.memory'
    flags: IGNORECASE
finding_template:
  title: Namespace resource quota configured
  description: Configuration sets resource quotas for namespace
  recommendation: Enforce quotas per team/project per FRR-RSC-01
  references:
    - FRR-RSC-01

---
pattern_id: rsc.allocation.priority_class
name: Priority Class for Resource Allocation
family: RSC
severity: medium
description: Detects priority class usage for workload prioritization
pattern_type: configuration
languages:
  - yaml
regex_patterns:
  - pattern: 'priorityClassName|priority_class_name'
    flags: IGNORECASE
  - pattern: 'kind:.*PriorityClass'
    flags: IGNORECASE
finding_template:
  title: Priority class for resource allocation
  description: Configuration uses priority classes for workload scheduling
  recommendation: Define priority classes for critical vs non-critical workloads
  references:
    - FRR-RSC-03

---
pattern_id: rsc.cost.budget_alert
name: Cost Budget Alerts
family: RSC
severity: medium
description: Detects cost budget alert configuration for resource management
pattern_type: resource
languages:
  - bicep
  - terraform
regex_patterns:
  - pattern: 'Microsoft\.Consumption/budgets'
    flags: IGNORECASE
  - pattern: 'azurerm_consumption_budget'
    flags: IGNORECASE
  - pattern: 'budget.*alert|cost.*threshold'
    flags: IGNORECASE
finding_template:
  title: Cost budget alerts configured
  description: IaC configures budget alerts for resource cost management
  recommendation: Set alerts at 50%, 80%, 100% of budget per FRR-RSC-04
  references:
    - FRR-RSC-04

---
pattern_id: rsc.iac.app_service_plan
name: Azure App Service Plan Configuration
family: RSC
severity: high
description: Detects App Service Plan configuration for resource allocation
pattern_type: resource
languages:
  - bicep
  - terraform
ast_queries:
  - query_type: resource_type
    target: Microsoft.Web/serverfarms
  - query_type: resource_type
    target: azurerm_app_service_plan
regex_patterns:
  - pattern: 'Microsoft\.Web/serverfarms'
    flags: IGNORECASE
  - pattern: 'resource.*azurerm_app_service_plan|resource.*azurerm_service_plan'
    flags: IGNORECASE
  - pattern: 'sku.*name.*P1V3|tier.*PremiumV3'
    flags: IGNORECASE
finding_template:
  title: App Service Plan configured
  description: IaC provisions App Service Plan with defined SKU
  recommendation: Choose appropriate SKU based on workload requirements per FRR-RSC-01
  references:
    - FRR-RSC-01

---
pattern_id: rsc.iac.vm_size
name: Virtual Machine Size Configuration
family: RSC
severity: high
description: Detects VM size configuration for resource allocation
pattern_type: resource
languages:
  - bicep
  - terraform
regex_patterns:
  - pattern: 'vmSize|vm_size'
    flags: IGNORECASE
  - pattern: 'Standard_D|Standard_E|Standard_F'
    flags: IGNORECASE
finding_template:
  title: VM size configured
  description: IaC specifies VM size for resource allocation
  recommendation: Right-size VMs based on actual usage metrics per FRR-RSC-03
  references:
    - FRR-RSC-01

---
pattern_id: rsc.iac.reserved_instances
name: Reserved Instance Usage
family: RSC
severity: low
description: Detects reserved instance or savings plan configuration
pattern_type: configuration
languages:
  - bicep
  - terraform
regex_patterns:
  - pattern: 'reserved.*instance|reservation|savings.*plan'
    flags: IGNORECASE
finding_template:
  title: Reserved instance or savings plan detected
  description: Configuration uses reserved instances for cost optimization
  recommendation: Analyze usage patterns and purchase reservations per FRR-RSC-04
  references:
    - FRR-RSC-04

---
pattern_id: rsc.cicd.resource_validation
name: Resource Configuration Validation
family: RSC
severity: high
description: Detects resource configuration validation in CI/CD
pattern_type: pipeline
languages:
  - github_actions
  - azure_pipelines
  - gitlab_ci
regex_patterns:
  - pattern: 'validate.*resources|check.*limits|verify.*quotas'
    flags: IGNORECASE
  - pattern: 'kubectl.*dry-run|terraform.*plan'
    flags: IGNORECASE
finding_template:
  title: Resource configuration validation in CI/CD
  description: Pipeline validates resource configurations before deployment
  recommendation: Include checks for resource limits and quotas per FRR-RSC-01
  references:
    - FRR-RSC-01

---
pattern_id: rsc.missing_resource_limits
name: Missing Resource Limits
family: RSC
severity: critical
description: Detects absence of resource limit configuration
pattern_type: configuration
languages:
  - yaml
requires_absence:
  - rsc.allocation.resource_limits
finding_template:
  title: No resource limits configured
  description: Configuration lacks resource limits (CPU, memory)
  severity: critical
  recommendation: Add resource limits to prevent resource exhaustion per FRR-RSC-01
  references:
    - FRR-RSC-01
